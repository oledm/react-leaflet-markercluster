"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function havingDeprecatedProps(e){return-1!==e.findIndex(function(e){return e.lat||e.lng})}function isArraysEqual(e,r){return JSON.stringify(e)===JSON.stringify(r)}function removeMarkersWithSameCoordinates(e){var r=[e[0]];return e.forEach(function(e){JSON.stringify(r).includes(JSON.stringify(e))||r.push(e)}),r}function noop(){}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,t,a){return t&&e(r.prototype,t),a&&e(r,a),r}}(),_react=require("react"),_react2=_interopRequireDefault(_react),_propTypes=require("prop-types"),_propTypes2=_interopRequireDefault(_propTypes),_reactLeaflet=require("react-leaflet"),_leaflet=require("leaflet"),_leaflet2=_interopRequireDefault(_leaflet);require("leaflet.markercluster"),require("./deprecated-styles.css");var MarkerClusterGroup=function(e){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).apply(this,arguments))}return _inherits(r,_reactLeaflet.LayerGroup),_createClass(r,[{key:"componentWillMount",value:function(){var e=this.props,r=e.markers,t=e.options;this.leafletElement=_leaflet2.default.markerClusterGroup(t),this.initMapClasses(),r.length&&(this.addLayersWithMarkersFromProps(r),havingDeprecatedProps(r)&&console.warn('[react-leaflet-markercluster] Warning: marker "lat: xx", "lng: xx" properties are deprecated and will be removed in v1.2.0. Please use "position: [lat, lng]" instead https://goo.gl/s7a6Cj')),this.initEventListeners(this.leafletElement)}},{key:"componentWillReceiveProps",value:function(e){isArraysEqual(this.props.markers,e.markers)||(this.layerContainer.removeLayer(this.leafletElement),this.leafletElement.clearLayers(),e.markers.length&&this.addLayersWithMarkersFromProps(e.markers))}},{key:"initMapClasses",value:function(){var e=this.props.wrapperOptions;if(e){console.warn('[react-leaflet-markercluster] Warning: "wrapperOptions" property is deprecated and will be removed in v1.2.0. Please see: https://goo.gl/s7a6Cj');var r=this.context.map._container.className,t=-1!==r.indexOf("marker-cluster-styled"),a=-1!==r.indexOf("marker-cluster-animated");e.enableDefaultStyle&&!t&&(this.context.map._container.className+=" marker-cluster-styled"),e.disableDefaultAnimation||a||(this.context.map._container.className+=" marker-cluster-animated")}}},{key:"addLayersWithMarkersFromProps",value:function(e){var r=this.props,t=r.markerOptions,a=r.wrapperOptions,n=r.children,o=r.onMarkerDrag,s=r.onMarkerDragstart,l=r.onMarkerDragend,i=t?Object.assign({},t):{},p=[];(a&&a.removeDuplicates?removeMarkersWithSameCoordinates(e):e).forEach(function(e){var r=e.options?Object.assign({},e.options):null,t=_leaflet2.default.marker(e.position||[e.lat,e.lng],r||i);t.on("drag",o),t.on("dragend",l),t.on("dragstart",s),e.popup&&t.bindPopup(e.popup),e.tooltip&&t.bindTooltip(e.tooltip),p.push(t)}),this.leafletElement.addLayers(p),n||this.layerContainer.addLayer(this.leafletElement)}},{key:"initEventListeners",value:function(e){var r=this;this.props.onMarkerClick&&e.on("click",function(e){r.props.onMarkerClick(e.layer)}),this.props.onClusterClick&&e.on("clusterclick",function(e){r.props.onClusterClick(e.layer)}),this.props.onPopupClose&&e.on("popupclose",function(e){r.props.onPopupClose(e.popup)})}},{key:"addLayersWithReactLeafletMarkers",value:function(){var e=this,r=[];return _react.Children.map(this.props.children,function(t,a){return(0,_react.cloneElement)(t,{ref:function(t){t&&(r.push(t.leafletElement),a!==e.props.children.length-1&&Array.isArray(e.props.children)||(e.leafletElement.addLayers(r),e.layerContainer.addLayer(e.leafletElement)))},key:"react-leaflet-marker-"+JSON.stringify(t.props.position)+"-"+a})})}},{key:"getLeafletElement",value:function(){return this.leafletElement}},{key:"render",value:function(){return this.props.children?_react2.default.createElement("section",{className:"marker-cluster-group"},this.addLayersWithReactLeafletMarkers()):null}}]),r}();exports.default=MarkerClusterGroup,MarkerClusterGroup.propTypes={markers:_propTypes2.default.arrayOf(_propTypes2.default.object),children:_propTypes2.default.node,options:_propTypes2.default.object,markerOptions:_propTypes2.default.object,wrapperOptions:_propTypes2.default.object,onMarkerClick:_propTypes2.default.func,onClusterClick:_propTypes2.default.func,onPopupClose:_propTypes2.default.func,onMarkerDrag:_propTypes2.default.func,onMarkerDragstart:_propTypes2.default.func,onMarkerDragend:_propTypes2.default.func},MarkerClusterGroup.defaultProps={markers:[],onMarkerDrag:noop,onMarkerDragstart:noop,onMarkerDragend:noop};
